<template>
<th title="Click to sort. Drag to center to group." :class="labelClass" :style="columnStyles" v-if="visible">

    <template v-if="type==='checkbox'">
      <input name="mix-table-checkbox-all" type="checkbox" v-on:change="onSelectedAll($event)"/>
</template>
      <template v-else>
<div class="mix-table-column">
    <span><slot>{{ label || dataField }}</slot></span>
    <span class="mix-table-sort-arrow" v-show="sorting"></span>
</div>
</template>
</th>
</template>

<script>
export default {

    props: {

        dataField: {
            type: String,
            required: true
        },

        label: {
            type: String
        },

        width: {
            type: [Number, String]
        },

        format: {
            type: Function
        },

        visible: {
            type: Boolean,
            default: true
        },

        type: {
            type: String,
            default: 'text'
        },

        labelClass: {
            type: String
        },

        dataClass: {
            type: String
        },

        target: { type: String },

        sortable: {
            type: Boolean,
            default: true
        },

        groupable: {
            type: Boolean,
            default: true
        }

    },

    data() {
        return {
            sortingDirection: 1
        };
    },

    computed: {

        sorting: {
            get() {
                return (this.$parent.sortingId === this.id && this.sortable);
            },
            set(value) {
                if (value && this.sortable) {
                    this.$parent.sortingId = this.id;
                }
            }
        },

        columnWidth() {
            if (!this.width) {
                return;
            }

            let suffix = isNaN(this.width) ? "" : "%";

            return this.width + suffix;
        },

        columnStyles() {
            return {
                width: this.columnWidth
            };
        },

        sortArrowClass() {
            let direction = sortClassMap[this.sortingDirection];
            return "datatable-sort-arrow-" + direction;
        },

        // template() {
        //     return this.$parent.$scopedSlots[this.id];
        // }

    },

    methods: {

        sort() {
            if (this.sorting) {
                this.sortingDirection *= -1;
                return;
            }

            this.sorting = true;
        },

        onSelectedAll(e) {

            this.$parent.onSelectedAll(e.target.checked);
        },

        renderData(value, row, index) {
            if (!this.format) {
                return value;
            }

            return this.format(value, row, index);
        },

        // dragStart(event) {
        //     event.stopPropagation();
        //     event.dataTransfer.dropEffect = "copy";
        //     event.dataTransfer.setData("text", this.id);
        // }

    },

    created() {
        let addColumn = this.$parent.addColumn;

        if (!addColumn) {
            console.warn("A datatable-column must be registered within a datatable component.");
            return;
        }

        addColumn(this);
    },

    destroyed() {
        this.$parent.removeColumn(this);
    }

}
</script>
